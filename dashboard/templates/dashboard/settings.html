{% include 'dashboard/partials/breadcrumb.html' %}

<!-- Header -->
<div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3 mb-4">
    <div>
        <h1 class="text-2xl font-bold">School Settings</h1>
        <p class="text-base-content/60 text-sm">Manage your school configuration and academic settings</p>
    </div>
</div>

<!-- Tabs Navigation -->
<div class="tabs tabs-boxed bg-base-200 p-1 mb-4 flex-wrap">
    <a class="tab {% if active_tab == 'school-info' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=school-info"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-school mr-2"></i> School Info
    </a>
    <a class="tab {% if active_tab == 'academic-years' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=academic-years"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-calendar-alt mr-2"></i> Academic Years
    </a>
    <a class="tab {% if active_tab == 'terms' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=terms"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-calendar-week mr-2"></i> Terms
    </a>
    <a class="tab {% if active_tab == 'grade-levels' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=grade-levels"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-layer-group mr-2"></i> Grade Levels
    </a>
    <a class="tab {% if active_tab == 'programmes' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=programmes"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-graduation-cap mr-2"></i> Programmes
    </a>
    <a class="tab {% if active_tab == 'grading-scales' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=grading-scales"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-chart-bar mr-2"></i> Grading Scales
    </a>
    <a class="tab {% if active_tab == 'assessment-types' %}tab-active{% endif %}"
       hx-get="{% url 'dashboard:settings' %}?tab=assessment-types"
       hx-target="#main-content"
       hx-push-url="true">
        <i class="fas fa-tasks mr-2"></i> Assessment Types
    </a>
</div>

<!-- Tab Content -->
<div id="settings-tab-content">
    {% if active_tab == 'school-info' %}
        {% include 'dashboard/partials/settings_school_info.html' %}
    {% elif active_tab == 'academic-years' %}
        {% include 'dashboard/partials/settings_academic_years.html' %}
    {% elif active_tab == 'terms' %}
        {% include 'dashboard/partials/settings_terms.html' %}
    {% elif active_tab == 'grade-levels' %}
        {% include 'dashboard/partials/settings_grade_levels.html' %}
    {% elif active_tab == 'programmes' %}
        {% include 'dashboard/partials/settings_programmes.html' %}
    {% elif active_tab == 'grading-scales' %}
        {% include 'dashboard/partials/settings_grading_scales.html' %}
    {% elif active_tab == 'assessment-types' %}
        {% include 'dashboard/partials/settings_assessment_types.html' %}
    {% endif %}
</div>

<!-- Toast Container -->
<div id="toast-container" class="toast toast-top toast-end z-50"></div>

<script>
    (function() {
        // Prevent duplicate event listeners by using a flag
        if (window._settingsListenersInitialized) return;
        window._settingsListenersInitialized = true;

        document.body.addEventListener('closeModal', function() {
            const modal = document.querySelector('.modal');
            if (modal) modal.remove();
        });

        // Listen for settings saved event and show success toast
        document.body.addEventListener('settingsSaved', function() {
            showToast('Settings saved successfully!', 'success');
        });

        window.showToast = function(message, type) {
            type = type || 'info';
            const container = document.getElementById('toast-container');
            if (!container) return;

            const alertClass = type === 'success' ? 'alert-success' :
                              type === 'error' ? 'alert-error' :
                              type === 'warning' ? 'alert-warning' : 'alert-info';
            const icon = type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-times-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';

            const toast = document.createElement('div');
            toast.className = `alert ${alertClass} shadow-lg text-sm py-2 px-4`;
            toast.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;

            container.appendChild(toast);

            // Auto-remove after 3 seconds
            setTimeout(function() {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(function() { toast.remove(); }, 300);
            }, 3000);
        };
    })();
</script>
