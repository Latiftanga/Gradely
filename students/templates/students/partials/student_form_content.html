{% include 'dashboard/partials/breadcrumb.html' %}

<!-- Header -->
<div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3 mb-5">
    <div class="flex items-center gap-3">
        <div class="avatar placeholder">
            <div class="bg-primary text-primary-content rounded-full w-11 h-11">
                {% if student %}
                    <span class="text-base">{{ student.first_name|slice:":1" }}{{ student.last_name|slice:":1" }}</span>
                {% else %}
                    <i class="fas fa-user-plus"></i>
                {% endif %}
            </div>
        </div>
        <div>
            <h1 class="text-xl font-bold">
                {% if student %}
                    Edit Student
                {% else %}
                    Add New Student
                {% endif %}
            </h1>
            <p class="text-base-content/60 text-sm">
                {% if student %}
                    Update {{ student.get_full_name }}'s information
                {% else %}
                    Register a new student in the system
                {% endif %}
            </p>
        </div>
    </div>
    <button class="btn btn-ghost btn-xs"
            hx-get="{% url 'students:list' %}"
            hx-target="#main-content"
            hx-push-url="true">
        <i class="fas fa-arrow-left"></i> Back to List
    </button>
</div>

<!-- Form -->
<form method="post"
      {% if student %}
          action="{% url 'students:update' student.pk %}"
      {% else %}
          action="{% url 'students:add' %}"
      {% endif %}
      hx-post="{% if student %}{% url 'students:update' student.pk %}{% else %}{% url 'students:add' %}{% endif %}"
      hx-target="#main-content"
      hx-swap="innerHTML"
      hx-push-url="true">
    {% csrf_token %}

    {% if form.errors %}
        <div class="alert alert-error mb-4 shadow-sm py-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-5 w-5" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <div>
                <h3 class="font-bold text-sm">Please fix the following errors:</h3>
                <ul class="list-disc list-inside text-xs mt-1">
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}

    <div class="grid grid-cols-1 xl:grid-cols-4 gap-4">
        <!-- Main Form Columns -->
        <div class="xl:col-span-3 space-y-4">
            <!-- Account & Personal Information Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <!-- Account Information Section -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body p-4">
                        <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                            <i class="fas fa-envelope text-primary text-xs"></i>
                            Account Information
                        </h2>
                        <div class="space-y-3">
                            {% if form.email %}
                            <div class="form-control">
                                <label class="label py-0.5" for="{{ form.email.id_for_label }}">
                                    <span class="label-text text-xs">Email <span class="text-error">*</span></span>
                                </label>
                                {{ form.email }}
                            </div>
                            {% endif %}
                            {% if form.password %}
                            <div class="form-control">
                                <label class="label py-0.5" for="{{ form.password.id_for_label }}">
                                    <span class="label-text text-xs">Password <span class="text-error">*</span></span>
                                </label>
                                {{ form.password }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Personal Information Section -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body p-4">
                        <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                            <i class="fas fa-user text-primary text-xs"></i>
                            Personal Information
                        </h2>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">First Name <span class="text-error">*</span></span></label>
                                {{ form.first_name }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Middle Name</span></label>
                                {{ form.middle_name }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Last Name <span class="text-error">*</span></span></label>
                                {{ form.last_name }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Gender <span class="text-error">*</span></span></label>
                                {{ form.gender }}
                            </div>
                            <div class="form-control col-span-2">
                                <label class="label py-0.5"><span class="label-text text-xs">Date of Birth <span class="text-error">*</span></span></label>
                                {{ form.date_of_birth }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Identification & Academic Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <!-- Identification Section -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body p-4">
                        <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                            <i class="fas fa-id-card text-primary text-xs"></i>
                            Identification
                        </h2>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Student ID <span class="text-error">*</span></span></label>
                                {{ form.student_id }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Index Number</span></label>
                                {{ form.index_number }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Admission No.</span></label>
                                {{ form.admission_number }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Ghana Card</span></label>
                                {{ form.ghana_card_number }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Academic Information Section -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body p-4">
                        <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                            <i class="fas fa-graduation-cap text-primary text-xs"></i>
                            Academic Information
                        </h2>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="form-control col-span-2">
                                <label class="label py-0.5"><span class="label-text text-xs">Current Class</span></label>
                                {{ form.current_class }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Admission Date</span></label>
                                {{ form.admission_date }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Previous School</span></label>
                                {{ form.previous_school }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Location & Residential Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <!-- Location Section -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body p-4">
                        <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                            <i class="fas fa-map-marker-alt text-primary text-xs"></i>
                            Location
                        </h2>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Hometown</span></label>
                                {{ form.hometown }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Region</span></label>
                                {{ form.region }}
                            </div>
                            <div class="form-control col-span-2">
                                <label class="label py-0.5"><span class="label-text text-xs">Nationality</span></label>
                                {{ form.nationality }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Residential Section -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body p-4">
                        <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                            <i class="fas fa-home text-primary text-xs"></i>
                            Residential
                        </h2>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">Status</span></label>
                                {{ form.residential_status }}
                            </div>
                            <div class="form-control">
                                <label class="label py-0.5"><span class="label-text text-xs">House</span></label>
                                {{ form.house }}
                            </div>
                            <div class="form-control col-span-2">
                                <label class="label py-0.5"><span class="label-text text-xs">Address</span></label>
                                {{ form.residential_address }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Information -->
            <div class="card bg-base-100 shadow">
                <div class="card-body p-4">
                    <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                        <i class="fas fa-heartbeat text-primary text-xs"></i>
                        Health Information
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                        <div class="form-control">
                            <label class="label py-0.5"><span class="label-text text-xs">Blood Group</span></label>
                            {{ form.blood_group }}
                        </div>
                        <div class="form-control">
                            <label class="label py-0.5"><span class="label-text text-xs">Medical Conditions</span></label>
                            {{ form.medical_conditions }}
                        </div>
                        <div class="form-control">
                            <label class="label py-0.5"><span class="label-text text-xs">Allergies</span></label>
                            {{ form.allergies }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar Column -->
        <div class="space-y-4">
            <!-- Status Card -->
            <div class="card bg-base-100 shadow">
                <div class="card-body p-4">
                    <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                        <i class="fas fa-toggle-on text-primary text-xs"></i>
                        Status
                    </h2>
                    <div class="space-y-3">
                        <div class="form-control">
                            <label class="label cursor-pointer justify-start gap-2 py-1">
                                {{ form.is_active }}
                                <div>
                                    <span class="label-text text-xs font-medium">Active</span>
                                    <p class="text-[10px] text-base-content/60">Currently enrolled</p>
                                </div>
                            </label>
                        </div>

                        {% if student %}
                        <div class="divider my-1 text-xs">Withdrawal Info</div>
                        <div class="form-control">
                            <label class="label py-0.5"><span class="label-text text-xs">Withdrawal Date</span></label>
                            {{ form.withdrawal_date }}
                        </div>
                        <div class="form-control">
                            <label class="label py-0.5"><span class="label-text text-xs">Reason</span></label>
                            {{ form.withdrawal_reason }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Actions Card -->
            <div class="card bg-base-100 shadow sticky top-4">
                <div class="card-body p-4">
                    <h2 class="card-title text-sm border-b border-base-200 pb-2 mb-3">
                        <i class="fas fa-check-circle text-primary text-xs"></i>
                        Actions
                    </h2>
                    <div class="space-y-2">
                        <button type="submit" class="btn btn-primary btn-sm btn-block">
                            <span class="htmx-indicator loading loading-spinner loading-xs"></span>
                            {% if student %}
                                <i class="fas fa-save"></i> Save Changes
                            {% else %}
                                <i class="fas fa-user-plus"></i> Add Student
                            {% endif %}
                        </button>
                        <button type="button" class="btn btn-ghost btn-sm btn-block"
                                hx-get="{% url 'students:list' %}"
                                hx-target="#main-content"
                                hx-push-url="true">
                            Cancel
                        </button>
                    </div>
                    <p class="text-[10px] text-base-content/50 mt-2">
                        <span class="text-error">*</span> Required fields
                    </p>
                </div>
            </div>
        </div>
    </div>
</form>
