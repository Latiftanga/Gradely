{% include 'dashboard/partials/breadcrumb.html' %}

<!-- Header -->
<div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3 mb-4">
    <div>
        <div class="flex items-center gap-2">
            <h1 class="text-2xl font-bold">{{ assessment.title }}</h1>
            {% if assessment.is_published %}
                <span class="badge badge-success">Published</span>
            {% else %}
                <span class="badge badge-warning">Draft</span>
            {% endif %}
        </div>
        <p class="text-base-content/60 text-sm">
            {{ assessment.class_subject.class_instance }} - {{ assessment.class_subject.subject.name }}
            &bull; {{ assessment.term }}
        </p>
    </div>
    <div class="flex gap-2">
        <button class="btn btn-outline btn-sm"
                hx-post="{% url 'grades:toggle_publish' pk=assessment.pk %}"
                hx-swap="none"
                hx-target="this">
            {% if assessment.is_published %}
                <i class="fas fa-eye-slash"></i> Unpublish
            {% else %}
                <i class="fas fa-eye"></i> Publish
            {% endif %}
        </button>
        <a class="btn btn-primary btn-sm"
           hx-get="{% url 'grades:grade_entry' assessment_pk=assessment.pk %}"
           hx-target="#main-content"
           hx-swap="innerHTML"
           hx-push-url="{% url 'grades:grade_entry' assessment_pk=assessment.pk %}">
            <i class="fas fa-edit"></i> Enter Grades
        </a>
    </div>
</div>

<!-- Assessment Info Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
    <div class="card bg-base-100 shadow">
        <div class="card-body p-4">
            <div class="flex items-center gap-3">
                <div class="avatar placeholder">
                    <div class="bg-primary/10 text-primary rounded-full w-12">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                <div>
                    <div class="text-sm text-base-content/60">Max Score</div>
                    <div class="text-xl font-bold">{{ assessment.max_score }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="card bg-base-100 shadow">
        <div class="card-body p-4">
            <div class="flex items-center gap-3">
                <div class="avatar placeholder">
                    <div class="bg-success/10 text-success rounded-full w-12">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div>
                    <div class="text-sm text-base-content/60">Graded</div>
                    <div class="text-xl font-bold">{{ graded_count }}/{{ total_students }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="card bg-base-100 shadow">
        <div class="card-body p-4">
            <div class="flex items-center gap-3">
                <div class="avatar placeholder">
                    <div class="bg-info/10 text-info rounded-full w-12">
                        <i class="fas fa-calculator"></i>
                    </div>
                </div>
                <div>
                    <div class="text-sm text-base-content/60">Average</div>
                    <div class="text-xl font-bold">{% if average_score %}{{ average_score }}{% else %}-{% endif %}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="card bg-base-100 shadow">
        <div class="card-body p-4">
            <div class="flex items-center gap-3">
                <div class="avatar placeholder">
                    <div class="bg-secondary/10 text-secondary rounded-full w-12">
                        <i class="fas fa-tag"></i>
                    </div>
                </div>
                <div>
                    <div class="text-sm text-base-content/60">Type</div>
                    <div class="text-xl font-bold">{{ assessment.assessment_type.name }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assessment Details -->
<div class="card bg-base-100 shadow mb-4">
    <div class="card-body p-4">
        <h3 class="font-semibold mb-2">Assessment Details</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            {% if assessment.date %}
            <div>
                <span class="text-base-content/60">Date:</span>
                <span class="font-medium">{{ assessment.date }}</span>
            </div>
            {% endif %}
            {% if assessment.due_date %}
            <div>
                <span class="text-base-content/60">Due Date:</span>
                <span class="font-medium">{{ assessment.due_date }}</span>
            </div>
            {% endif %}
            <div>
                <span class="text-base-content/60">Weight:</span>
                <span class="font-medium">{{ assessment.weight }}</span>
            </div>
            <div>
                <span class="text-base-content/60">Created:</span>
                <span class="font-medium">{{ assessment.created_at|date:"M d, Y" }}</span>
            </div>
        </div>
        {% if assessment.description %}
        <div class="mt-3">
            <span class="text-base-content/60">Description:</span>
            <p class="mt-1">{{ assessment.description }}</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Student Grades Table -->
<div class="card bg-base-100 shadow">
    <div class="card-body p-0">
        <div class="flex justify-between items-center p-4 border-b">
            <h3 class="font-semibold">Student Grades</h3>
        </div>
        {% if student_grades %}
        <div class="overflow-x-auto">
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Student</th>
                        <th>Score</th>
                        <th>Percentage</th>
                        <th>Grade</th>
                        <th>Status</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sg in student_grades %}
                    <tr class="hover">
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <div class="flex items-center gap-2">
                                <div class="avatar placeholder">
                                    <div class="bg-primary text-primary-content rounded-full w-8">
                                        <span class="text-xs">{{ sg.student.first_name.0 }}{{ sg.student.last_name.0 }}</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="font-medium">{{ sg.student.get_full_name }}</div>
                                    <div class="text-sm text-base-content/60">{{ sg.student.student_id }}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            {% if sg.is_absent %}
                                <span class="text-base-content/40">Absent</span>
                            {% elif sg.score is not None %}
                                <span class="font-medium">{{ sg.score }}/{{ assessment.max_score }}</span>
                            {% else %}
                                <span class="text-base-content/40">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if sg.percentage is not None %}
                                <span class="{% if sg.percentage >= 70 %}text-success{% elif sg.percentage >= 50 %}text-warning{% else %}text-error{% endif %} font-medium">
                                    {{ sg.percentage }}%
                                </span>
                            {% else %}
                                <span class="text-base-content/40">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if sg.letter_grade %}
                                <span class="badge badge-outline">{{ sg.letter_grade }}</span>
                            {% else %}
                                <span class="text-base-content/40">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if sg.is_absent %}
                                <span class="badge badge-error badge-sm">Absent</span>
                            {% elif sg.score is not None %}
                                <span class="badge badge-success badge-sm">Graded</span>
                            {% else %}
                                <span class="badge badge-ghost badge-sm">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="text-sm text-base-content/60">{{ sg.remarks|default:"-" }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="flex flex-col items-center justify-center py-12 text-center">
            <div class="avatar placeholder mb-4">
                <div class="bg-base-200 text-base-content/40 rounded-full w-16 h-16">
                    <i class="fas fa-users text-2xl"></i>
                </div>
            </div>
            <h3 class="font-semibold text-lg">No Students Enrolled</h3>
            <p class="text-base-content/60 max-w-md mt-1">
                There are no students enrolled in this class for the current academic year.
            </p>
        </div>
        {% endif %}
    </div>
</div>
